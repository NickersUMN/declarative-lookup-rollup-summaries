<template>

  <div class="slds-m-bottom_medium">
    <article class="slds-card">

      <!-- HEADER -->
      <div class="slds-card__header slds-grid">
        <header class="slds-media slds-media_center slds-has-flexi-truncate">
          <div class="slds-media__body">
            <h2 class="slds-card__header-title">
              <div class="slds-card__header-link slds-truncate" title="Lookup Rollup Summary Creation Wizard">
                <span>Lookup Rollup Summary Creation Wizard</span>
              </div>
            </h2>
          </div>
          <div class="slds-no-flex">

              <lightning-button-group>
                <lightning-button label="Save" onclick={runSave}></lightning-button>
                <lightning-button
                  label="Cancel"
                  onclick={cancelClickHandler}
                ></lightning-button>
                <lightning-button
                  label="Activate"
                  onclick={activateClickHandler}
                  if:true={rollupCanBeActivated}
                ></lightning-button>
                <lightning-button
                  label="Deactivate"
                  onclick={deactivateClickHandler}
                  if:true={rollupCanBeDeactivated}
                ></lightning-button>
                <lightning-button
                  label="Clone"
                  onclick={cloneClickHandler}
                  if:true={rollup.Id}
                ></lightning-button>
                <lightning-button
                  label="Delete"
                  onclick={deleteClickHandler}
                  variant="destructive"
                  if:true={rollup.Id}
                ></lightning-button>
              </lightning-button-group>
          </div>
        </header>
      </div>

      <!-- BODY -->
      <div class="slds-card__body slds-card__body_inner">

        <c-rollup-editor-error errors={errors.record}></c-rollup-editor-error>

        <!-- Rollup Name Section -->
        <div class="slds-m-top_large">
          <div class="slds-section slds-is-open" data-section-name="section_information">
            <h3 class="slds-section__title">
              <button onclick={onToggleSection}  data-section-button="section_information" class="slds-button slds-section__title-action">
                <svg class="slds-section__title-action-icon slds-button__icon slds-button__icon_left" >
                  <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#switch"></use>
                </svg>
                <span class="slds-truncate" title="Information">Information</span>
              </button>
            </h3>
            <div class="slds-section__content" >

              <div class="slds-grid slds-gutters slds-wrap">

                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-m-top_x-small">
                  <!-- Lookup Rollup Summary Label -->
                  <lightning-input
                    type="text"
                    name="rollup_Label"
                    data-name="rollup_Label"
                    label="Lookup Rollup Summary Label"
                    placeholder="My Rollup Name"
                    value={rollup.Label}
                  ></lightning-input>
                  <c-rollup-editor-error
                    errors={errors.Label}
                  ></c-rollup-editor-error>
                </div>

                  <!-- Lookup Rollup Summary API Name -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-m-top_x-small">
                  <lightning-input
                    type="text"
                    name="rollup_DeveloperName"
                    data-name="rollup_DeveloperName"
                    label="Lookup Rollup Summary API Name"
                    placeholder="My_Rollup_Name"
                    disabled={rollup.Id}
                    value={rollup.DeveloperName}
                  ></lightning-input>
                  <c-rollup-editor-error
                    errors={errors.DeveloperName}
                  ></c-rollup-editor-error>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- Lookup Object Section -->
        <div class="slds-m-top_large">

          <div class="slds-section slds-is-open" data-section-name="section_select-object">
            <h3 class="slds-section__title">
              <button onclick={onToggleSection} data-section-button="section_select-object" class="slds-button slds-section__title-action">
                <svg class="slds-section__title-action-icon slds-button__icon slds-button__icon_left" >
                  <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#switch"></use>
                </svg>
                <span class="slds-truncate" title="Select Object">Select Object</span>
              </button>
            </h3>
            <div  class="slds-section__content">
              
              <div class="slds-grid slds-gutters slds-wrap">

                <!-- Parent Object Combobox Input -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-m-top_x-small">

                  <c-object-selector
                    label="Parent Object"
                    current-selection={rollup.ParentObject__c}
                    onlookupupdate={parentObjectSelected}
                  ></c-object-selector>

                  <c-rollup-editor-error
                    errors={errors.ParentObject__c}
                  ></c-rollup-editor-error>

                </div>

                <!-- Child Object Combobox Input -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-m-top_x-small">

                  <c-object-selector
                    label="Child Object"
                    current-selection={rollup.ChildObject__c}
                    onlookupupdate={childObjectSelected}
                  ></c-object-selector>

                  <c-rollup-editor-error
                    errors={errors.ChildObject__c}
                  ></c-rollup-editor-error>

                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- Setup Relationship Section -->
        <div class="slds-m-top_large">

          <div class="slds-section slds-is-open" data-section-name="section_setup-relationship">
            <h3 class="slds-section__title">

              <button onclick={onToggleSection} data-section-button="section_setup-relationship"  class="slds-button slds-section__title-action">
                <svg class="slds-section__title-action-icon slds-button__icon slds-button__icon_left" >
                  <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#switch"></use>
                </svg>

                <span class="slds-truncate" title="Setup Relationship">Setup Relationship</span>
              </button>

            </h3>
            <div  class="slds-section__content">

              <div class="slds-grid slds-gutters slds-wrap">

                <!-- Relationship Field Input -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3 slds-m-top_x-small">
                  <lightning-input
                    type="text"
                    name="rollup_RelationshipField__c"
                    data-name="rollup_RelationshipField__c"
                    label="Relationship Field"
                    placeholder="lookup__c"
                    value={rollup.RelationshipField__c}
                  ></lightning-input>
                  <c-rollup-editor-error
                    errors={errors.RelationshipField__c}
                  ></c-rollup-editor-error>
                </div>

                <!-- Relationship Criteria Input -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3 slds-m-top_x-small">
                  <lightning-input
                    type="text"
                    name="rollup_RelationshipCriteria__c"
                    data-name="rollup_RelationshipCriteria__c"
                    label="Relationship Criteria"
                    placeholder="Status__c = 'Closed' AND Days__c > 30"
                    value={rollup.RelationshipCriteria__c}
                    maxlength="255"
                  ></lightning-input>
                  <c-rollup-editor-error
                    errors={errors.RelationshipCriteria__c}
                  ></c-rollup-editor-error>
                </div>

                <!-- Relationship Criteria Input -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3 slds-m-top_x-small">
                  <lightning-textarea
                    name="rollup_RelationshipCriteriaFields__c"
                    data-name="rollup_RelationshipCriteriaFields__c"
                    label="Relationship Criteria Fields"
                    placeholder="Status__c, Days__c"
                    value={rollup.RelationshipCriteriaFields__c}
                    maxlength="255"
                  ></lightning-textarea>
                  <c-rollup-editor-error
                    errors={errors.RelationshipCriteriaFields__c}
                  ></c-rollup-editor-error>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- Rollup Details Section -->
        <div class="slds-m-top_large">
          <div class="slds-section" data-section-name="section_rollup-details">
            <h3 class="slds-section__title">
              <button onclick={onToggleSection} data-section-button="section_rollup-details" class="slds-button slds-section__title-action">
                <svg class="slds-section__title-action-icon slds-button__icon slds-button__icon_left" >
                  <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#switch"></use>
                </svg>
                <span class="slds-truncate" title="Rollup Details">Rollup Details</span>
              </button>
            </h3>

            <div  class="slds-section__content slds-grid slds-wrap slds-gutters">

                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                  <!-- Field to Aggregate	 -->
                  <div class="slds-m-top_x-small">
                    <lightning-input
                      type="text"
                      name="rollup_FieldToAggregate__c"
                      data-name="rollup_FieldToAggregate__c"
                      label="Field to Aggregate"
                      value={rollup.FieldToAggregate__c}
                      required
                    ></lightning-input>
                    <c-rollup-editor-error
                      errors={errors.FieldToAggregate__c}
                    ></c-rollup-editor-error>
                  </div>

                  <!-- Field to Order By	 -->
                  <div class="slds-m-top_x-small">
                    <lightning-input
                      type="text"
                      name="rollup_FieldToOrderBy__c"
                      data-name="rollup_FieldToOrderBy__c"
                      label="Field to Order By"
                      value={rollup.FieldToOrderBy__c}
                    ></lightning-input>
                    <c-rollup-editor-error
                      errors={errors.FieldToOrderBy__c}
                    ></c-rollup-editor-error>
                  </div>

                  <!-- Aggregate Options -->
                  <div class="slds-m-top_x-small">
                    <lightning-combobox
                      name="rollup_AggregateOperation__c"
                      data-name="rollup_AggregateOperation__c"
                      label="Aggregate Operation"
                      placeholder="Select"
                      options={aggregateOptions}
                      value={rollup.AggregateOperation__c}
                      required
                    ></lightning-combobox>
                    <c-rollup-editor-error
                      errors={errors.FieldToOrderBy__c}
                    ></c-rollup-editor-error>
                  </div>

                  <!-- Aggregate Result Field -->
                  <div class="slds-m-top_x-small">
                    <lightning-input
                      type="text"
                      name="rollup_AggregateResultField__c"
                      data-name="rollup_AggregateResultField__c"
                      label="Aggregate Result Field"
                      value={rollup.AggregateResultField__c}
                    ></lightning-input>
                    <c-rollup-editor-error
                      errors={errors.AggregateResultField__c}
                    ></c-rollup-editor-error>
                  </div>

                  <!-- Aggregate All Rows -->
                  <div class="slds-m-top_x-small">
                    <lightning-input
                      type="checkbox"
                      name="rollup_AggregateAllRows__c"
                      data-name="rollup_AggregateAllRows__c"
                      label="Aggregate All Rows"
                      value={rollup.AggregateAllRows__c}
                      field-level-help="Include deleted records"
                      variant="label-stacked"
                      style="padding-left: 0px !important"
                    ></lightning-input>
                    <c-rollup-editor-error
                      errors={errors.AggregateAllRows__c}
                    ></c-rollup-editor-error>
                  </div>

                  <!-- Row Limit -->
                  <div class="slds-m-top_x-small">
                    <lightning-input
                      type="number"
                      name="rollup_RowLimit__c"
                      data-name="rollup_RowLimit__c"
                      label="Row Limit"
                      value={rollup.RowLimit__c}
                    ></lightning-input>
                    <c-rollup-editor-error
                      errors={errors.RowLimit__c}
                    ></c-rollup-editor-error>
                  </div>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                    <!-- Active Toggle -->
                    <div class="slds-m-top_x-small">
                        <lightning-input
                          type="toggle"
                          name="rollup_Active__c"
                          data-name="rollup_Active__c"
                          label="Rollup Status"
                          checked={rollup.Active__c}
                          variant="label-stacked"
                          style="padding-left: 0px !important"
                        ></lightning-input>
                        <c-rollup-editor-error
                          errors={errors.Active__c}
                        ></c-rollup-editor-error>
                    </div>

                  <!-- Calculation mode -->
                  <div class="slds-m-top_x-small">
                      <lightning-combobox
                        name="rollup_CalculationMode__c"
                        data-name="rollup_CalculationMode__c"
                        label="Calculation Mode"
                        placeholder="Select"
                        options={calculationModes}
                        value={rollup.CalculationMode__c}
                        required
                      ></lightning-combobox>
                      <c-rollup-editor-error
                        errors={errors.FieldToOrderBy__c}
                      ></c-rollup-editor-error>
                  </div>

                  <!-- Calculation Sharing Mode -->
                  <div class="slds-m-top_x-small">
                      <lightning-combobox
                        name="rollup_CalculationSharingMode__c"
                        data-name="rollup_CalculationSharingMode__c"
                        label="Calculation Sharing Mode"
                        placeholder="Select"
                        options={calculationSharingModes}
                        value={rollup.CalculationSharingMode__c}
                        required
                      ></lightning-combobox>
                      <c-rollup-editor-error
                        errors={errors.FieldToOrderBy__c}
                      ></c-rollup-editor-error>
                  </div>

                </div>

            </div>
          </div>
        </div>

        <!-- Text Lookups Section -->
        <div class="slds-m-top_large">
          <div class="slds-section" data-section-name="section_text-lookups">
            <h3 class="slds-section__title">
              <button onclick={onToggleSection} data-section-button="section_text-lookups" class="slds-button slds-section__title-action">
                <svg class="slds-section__title-action-icon slds-button__icon slds-button__icon_left" >
                  <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#switch"></use>
                </svg>
                <span class="slds-truncate" title="Text Lookups">Text Lookups</span>
              </button>
            </h3>
            <div  class="slds-section__content" >

              <div class="slds-grid slds-gutters slds-wrap">
                <!-- Concatenate Delimiter -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-m-top_x-small">
                    <lightning-input
                      type="text"
                      name="rollup_ConcatenateDelimiter__c"
                      data-name="rollup_ConcatenateDelimiter__c"
                      label="Concatenate Delimiter"
                      value={rollup.ConcatenateDelimiter__c}
                    ></lightning-input>
                    <c-rollup-editor-error
                      errors={errors.ConcatenateDelimiter__c}
                    ></c-rollup-editor-error>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Description Section -->
        <div class="slds-m-top_large">
          <div class="slds-section" data-section-name="section_description">
            <h3 class="slds-section__title">
              <button onclick={onToggleSection} data-section-button="section_description"  class="slds-button slds-section__title-action">
                <svg class="slds-section__title-action-icon slds-button__icon slds-button__icon_left" >
                  <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#switch"></use>
                </svg>
                <span class="slds-truncate" title="Description">Description</span>
              </button>
            </h3>
            <div  class="slds-section__content">
              <div class="slds-grid slds-gutters slds-wrap">
                <!-- Description -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3 slds-m-top_x-small">
                  <lightning-textarea
                    name="rollup_Description__c"
                    data-name="rollup_Description__c"
                    label="Description"
                    value={rollup.Description__c}
                    maxlength="255"
                  ></lightning-textarea>
                  <c-rollup-editor-error
                    errors={errors.Description__c}
                  ></c-rollup-editor-error>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Advanced Section -->
        <div class="slds-m-top_large">
          <div class="slds-section" data-section-name="section_advanced">
            <h3 class="slds-section__title">
              <button onclick={onToggleSection} data-section-button="section_advanced"  class="slds-button slds-section__title-action">
                <svg class="slds-section__title-action-icon slds-button__icon slds-button__icon_left" >
                  <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#switch"></use>
                </svg>
                <span class="slds-truncate" title="Advanced">Advanced</span>
              </button>
            </h3>
            <div  class="slds-section__content">
              <div class="slds-grid slds-gutters slds-wrap">

                <!-- Test Code (Child Object)	-->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3 slds-m-top_x-small">
                  <lightning-textarea
                    name="rollup_TestCode2__c"
                    data-name="rollup_TestCode2__c"
                    label="Test Code (Child Object)"
                    value={rollup.TestCode2__c}
                    maxlength="131072"
                  ></lightning-textarea>
                  <c-rollup-editor-error
                    errors={errors.TestCode2__c}
                  ></c-rollup-editor-error>
                </div>


                <!-- Test Code (Parent Object) -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3 slds-m-top_x-small">
                  <lightning-textarea
                    name="rollup_TestCodeParent__c"
                    data-name="rollup_TestCodeParent__c"
                    label="Test Code (Parent Object)"
                    value={rollup.TestCodeParent__c}
                    maxlength="131072"
                  ></lightning-textarea>
                  <c-rollup-editor-error
                    errors={errors.TestCodeParent__c}
                  ></c-rollup-editor-error>
                </div>

                  <!-- Test Code See All Data -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3 slds-m-top_x-small">
                    <lightning-input
                      type="checkbox"
                      name="rollup_TestCodeSeeAllData__c"
                      data-name="rollup_TestCodeSeeAllData__c"
                      label="Test Code See All Data"
                      value={rollup.TestCodeSeeAllData__c}
                      variant="label-stacked"
                      style="padding-left: 0px !important"
                    ></lightning-input>
                    <c-rollup-editor-error
                      errors={errors.TestCodeSeeAllData__c}
                    ></c-rollup-editor-error>
                  </div>

              </div>
            </div>
          </div>
        </div>



      </div>

    </article>
  </div>


  <c-rollup-status-check name={rollup.Id}></c-rollup-status-check>


















</template>
